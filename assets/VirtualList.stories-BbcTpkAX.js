import{j as d}from"./jsx-runtime-BwZVo4Wn.js";import{R as p}from"./index-BBkUAzwr.js";const q="_fixedHeightContainer_1dpmb_1",k="_contentContainer_1dpmb_8",G="_childContainer_1dpmb_21",N={fixedHeightContainer:q,contentContainer:k,childContainer:G},R=a=>{const{childHeight:u=50,childIndex:c,itemStyle:l}=a;return d.jsx("div",{className:N.childContainer,style:l??{position:"absolute",height:u,top:u*c},children:l?d.jsxs("span",{children:["序号",c+1," 高度：",l.height," top偏移：",l.top]}):d.jsxs("span",{children:[c+1," "]})},`${c}${l==null?void 0:l.height}`)},O={measuredDataMap:[],LastMeasuredItemIndex:-1},J=a=>{const{itemHeight:u=50,itemSumCount:c=1e3,listWidth:l,listHeight:g}=a,[I,m]=p.useState(0),f={position:"relative",width:l??400,height:g??600},y={height:u*c,width:"100%"},M=H=>{const{scrollTop:x}=H.currentTarget;m(x)},v=H=>{const{itemHeight:x=50,itemSumCount:w=1e3,listHeight:L=600}=H,b=Math.floor(I/x),r=Math.max(0,b-2),i=Math.ceil(L/x),t=Math.min(w,b+i+2),n=[];for(let e=r;e<t;e++)n.push(R({childHeight:x,childIndex:e}));return n};return d.jsx("div",{className:N.fixedHeightContainer,style:f,onScroll:M,children:d.jsx("div",{className:N.contentContainer,style:y,children:v(a)})})},K=a=>{const{itemHeight:u=50,itemSumCount:c=1e3,listWidth:l=400,listHeight:g=600}=a,I=p.useRef(new Array(c).fill(0).map(()=>u+Math.round(Math.random()*u))),m=t=>I.current[t],f={measuredDataMap:[],LastMeasuredItemIndex:-1},y=(t=50,n)=>{let e=0;const{measuredDataMap:o,LastMeasuredItemIndex:s}=f;if(s>=0){const C=o[s];e=C.topOffset+C.height}const h=n-f.LastMeasuredItemIndex-1;return e+h*t},M=t=>{const{measuredDataMap:n,LastMeasuredItemIndex:e}=f;if(t>e){let o=0;if(e>=0){const s=n[e];o+=s.topOffset+s.height}for(let s=e+1;s<=t;s++){const h=m(s);n[s]={height:h,topOffset:o},o+=h}f.LastMeasuredItemIndex=t}return n[t]},v=(t,n)=>{const{itemSumCount:e=1e3}=t;let o=0,s=e-1;for(;o<=s;){const h=Math.floor((o+s)/2),S=M(h).topOffset;if(S===n)return h;S<n?o=h+1:s=h-1}return o},H=(t,n)=>{const{listHeight:e=600,itemSumCount:o=1e3}=t,s=M(n),h=s.topOffset+e;let S=s.topOffset+s.height,C=n;for(;S<=h&&C<o-1;){C++;const F=M(C);S+=F.height}return C},x=(t,n)=>{const{itemSumCount:e=1e3,bufferNum:o=4}=t,s=v(t,n),h=H(t,s);return{bufferStartIndex:Math.max(0,s-o),bufferEndIndex:Math.min(e-1,h+o),startIndex:s,endIndex:h}},w=(t,n)=>{const e=[],{bufferStartIndex:o,bufferEndIndex:s}=x(t,n);for(let h=o;h<=s;h++){const S=M(h),C={position:"absolute",height:S.height,width:"100%",top:S.topOffset};e.push(d.jsx(R,{childIndex:h,itemStyle:C},h))}return console.log("✅ ~ measuredData:",f),e},L={position:"relative",width:l,height:g,overflow:"auto",boxSizing:"border-box"},b={height:y(u,c),width:"100%",boxSizing:"border-box"},[r,i]=p.useState(0);return p.useEffect(()=>{const t=document.querySelector(".uncertainHeightContainer");if(t){const n=e=>{const o=e.target;i(o.scrollTop)};return t.addEventListener("scroll",n),()=>{t.removeEventListener("scroll",n)}}},[]),d.jsxs("div",{className:"mainContainer",children:[d.jsxs("div",{className:"srcollNum",children:["已经滚动了：",Math.floor(r)]}),d.jsx("div",{className:"uncertainHeightContainer",style:L,children:d.jsx("div",{className:"contentContainer",style:b,children:w(a,r)})})]})},P=(()=>{let a=null;return()=>{if(a)return a;a=[];const u=1e3;for(let c=0;c<u;c++){const g={height:30+Math.floor(Math.random()*30),width:"100%"};a.push(d.jsx(R,{childIndex:c,itemStyle:g},c))}return a}})(),Q=a=>{const{itemStyle:u,getChildItem:c,onSizeChange:l,childIndex:g}=a,I=p.useRef(null),m=p.useRef(null);return p.useEffect(()=>{const f=I.current;return f&&(m.current||(m.current=new ResizeObserver(()=>{l(g,f)})),m.current.observe(f)),()=>{m.current&&f&&m.current.unobserve(f)}},[g,l]),d.jsx("div",{ref:I,style:u,children:c(g)})},X=a=>P()[a],Y=({itemSumCount:a=1e3,listWidth:u=400,listHeight:c=600,itemHeight:l=50})=>{const g=(r,i)=>{const t=i.children[0].offsetHeight,{measuredDataMap:n,LastMeasuredItemIndex:e}=O;n[r].height=t;let o=0;for(let s=0;s<=e;s++)n[s].topOffset=o,o+=n[s].height;i.style.height=t+"px",b(!0)},I=(r,i)=>{let t=0;const{measuredDataMap:n,LastMeasuredItemIndex:e}=O;return e>=0&&(t=n[e].topOffset+n[e].height),t+(i-e-1)*r},m=r=>{const{measuredDataMap:i,LastMeasuredItemIndex:t}=O;if(r>t){let n=t>=0?i[t].topOffset+i[t].height:0;for(let e=t+1;e<=r;e++)i[e]={height:50,topOffset:n},n+=50;O.LastMeasuredItemIndex=r}return i[r]},f=r=>{let i=0,t=a-1;for(;i<=t;){const n=Math.floor((i+t)/2),e=m(n).topOffset;if(e===r)return n;e<r?i=n+1:t=n-1}return i},y=r=>{const i=m(r),t=i.topOffset+c;let n=i.topOffset+i.height,e=r;for(;n<=t&&e<a-1;)e++,n+=m(e).height;return e},M=r=>{const t=f(r),n=y(t);return{bufferStartIndex:Math.max(0,t-4),bufferEndIndex:Math.min(a-1,n+4),startIndex:t,endIndex:n}},v=r=>{const i=[],{bufferStartIndex:t,bufferEndIndex:n}=M(r);for(let e=t;e<=n;e++){const o=m(e),s={position:"absolute",height:o.height,width:"100%",top:o.topOffset};i.push(d.jsx(Q,{childIndex:e,getChildItem:X,onSizeChange:g,itemStyle:s},`${e}${o.topOffset}`))}return i},H=p.useRef(null),[x,w]=p.useState(0),[L,b]=p.useState(!1);return console.log("✅ ~ needUpdate:",L),p.useEffect(()=>{if(!H.current)return;const r=H.current;if(r){const i=t=>{w(t.target.scrollTop)};return r.addEventListener("scroll",i),()=>{r.removeEventListener("scroll",i)}}},[]),d.jsxs("div",{className:"mainContainer",children:[d.jsxs("div",{className:"scrollNum",children:["已经滚动了：",Math.floor(x)]}),d.jsx("div",{className:"dynamicHeightContainer",ref:H,style:{position:"relative",width:u,height:c,overflow:"auto",boxSizing:"border-box"},children:d.jsx("div",{className:"contentContainer",style:{height:I(l,a),width:"100%",boxSizing:"border-box"},children:v(x)})})]})},Z={uncertainHeight:K,fixedHeight:J,dynamicHeight:Y},tt=({virtualListType:a="fixedHeight",itemHeight:u,itemSumCount:c,listWidth:l,listHeight:g,bufferNum:I,...m})=>Z[a]({itemHeight:u,itemSumCount:c,listWidth:l,listHeight:g}),st={title:"通用/VirtualList虚拟列表",component:tt,parameters:{layout:"centered"},tags:["autodocs"],argTypes:{}},E={args:{virtualListType:"uncertainHeight",listWidth:400,listHeight:600,itemHeight:50,itemSumCount:1e3}},j={args:{virtualListType:"fixedHeight",listWidth:400,listHeight:600,itemHeight:50,itemSumCount:1e3}},D={args:{virtualListType:"dynamicHeight",listWidth:400,listHeight:600,itemHeight:50,itemSumCount:1e3}};var T,_,z;E.parameters={...E.parameters,docs:{...(T=E.parameters)==null?void 0:T.docs,source:{originalSource:`{
  args: {
    virtualListType: 'uncertainHeight',
    listWidth: 400,
    listHeight: 600,
    // 预测高度
    itemHeight: 50,
    itemSumCount: 1000
  }
}`,...(z=(_=E.parameters)==null?void 0:_.docs)==null?void 0:z.source}}};var W,A,U;j.parameters={...j.parameters,docs:{...(W=j.parameters)==null?void 0:W.docs,source:{originalSource:`{
  args: {
    virtualListType: 'fixedHeight',
    listWidth: 400,
    listHeight: 600,
    // 实际高度
    itemHeight: 50,
    itemSumCount: 1000
  }
}`,...(U=(A=j.parameters)==null?void 0:A.docs)==null?void 0:U.source}}};var B,$,V;D.parameters={...D.parameters,docs:{...(B=D.parameters)==null?void 0:B.docs,source:{originalSource:`{
  args: {
    virtualListType: 'dynamicHeight',
    listWidth: 400,
    listHeight: 600,
    // 预测高度
    itemHeight: 50,
    itemSumCount: 1000
  }
}`,...(V=($=D.parameters)==null?void 0:$.docs)==null?void 0:V.source}}};const it=["UncertainHeight","FixedHeight","DynamicHeight"];export{D as DynamicHeight,j as FixedHeight,E as UncertainHeight,it as __namedExportsOrder,st as default};
